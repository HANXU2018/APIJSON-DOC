(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{466:function(r,e,t){"use strict";t.r(e);var _=t(4),v=Object(_.a)({},(function(){var r=this,e=r.$createElement,t=r._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[t("h1",{attrs:{id:"apijson通用文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apijson通用文档"}},[r._v("#")]),r._v(" APIJSON通用文档")]),r._v(" "),t("blockquote",[t("p",[r._v("本小节同步于 "),t("a",{attrs:{href:"https://github.com/Tencent/APIJSON/blob/master/Document.md",target:"_blank",rel:"noopener noreferrer"}},[r._v("Tencent/APIJSON/Document.md文档"),t("OutboundLink")],1),r._v("\n后端开发者可以先看这个详细的 "),t("a",{attrs:{href:"https://vincentcheng.github.io/apijson-doc/zh",target:"_blank",rel:"noopener noreferrer"}},[r._v("图文入门教程"),t("OutboundLink")],1),r._v("（如果和本文档有出入，以本文档为准，例如正则匹配 key? 已废弃，全面用 key~ 替代）")])]),r._v(" "),t("ul",[t("li",[t("h3",{attrs:{id:"_1-示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-示例"}},[r._v("#")]),r._v(" "),t("a",{attrs:{href:"#1"}},[r._v("1.示例")])])]),r._v(" "),t("li",[t("h3",{attrs:{id:"_2-对比传统方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-对比传统方式"}},[r._v("#")]),r._v(" "),t("a",{attrs:{href:"#2"}},[r._v("2.对比传统方式")])])]),r._v(" "),t("li",[t("a",{attrs:{href:"#2.1"}},[r._v("2.1 开发流程")])]),r._v(" "),t("li",[t("a",{attrs:{href:"#2.2"}},[r._v("2.2 前端请求")])]),r._v(" "),t("li",[t("a",{attrs:{href:"#2.3"}},[r._v("2.3 后端操作")])]),r._v(" "),t("li",[t("a",{attrs:{href:"#2.4"}},[r._v("2.4 前端解析")])]),r._v(" "),t("li",[t("a",{attrs:{href:"#2.5"}},[r._v("2.5 对应不同需求的请求")])]),r._v(" "),t("li",[t("a",{attrs:{href:"#2.6"}},[r._v("2.6 对应不同请求的结果")])]),r._v(" "),t("li",[t("h3",{attrs:{id:"_3-设计规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-设计规范"}},[r._v("#")]),r._v(" "),t("a",{attrs:{href:"#3"}},[r._v("3.设计规范")])])]),r._v(" "),t("li",[t("a",{attrs:{href:"#3.1"}},[r._v("3.1 操作方法")])]),r._v(" "),t("li",[t("a",{attrs:{href:"#3.2"}},[r._v("3.2 功能符")])])]),r._v(" "),t("h2",{attrs:{id:"_1-示例-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-示例-2"}},[r._v("#")]),r._v(" "),t("h2",{attrs:{id:"1"}},[r._v("1.示例"),t("h2")]),r._v(" "),t("h4",{attrs:{id:"获取用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取用户"}},[r._v("#")]),r._v(" 获取用户")]),r._v(" "),t("p",[r._v("请求：\n"),t("pre",[t("code",{staticClass:"language-json"},[r._v('{\n"User":{\n"id":38710\n }\n}\n')])])]),r._v(" "),t("p",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22id%22:38710%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("点击这里测试"),t("OutboundLink")],1)]),r._v(" "),t("p",[r._v("返回：\n"),t("pre",[t("code",{staticClass:"language-json"},[r._v('{\n"User":{\n"id":38710,\n"sex":0,\n"name":"TommyLemon",\n"tag":"Android&Java",\n"head":"http://static.oschina.net/uploads/user/1218/2437072_100.jpg?t=1461076033000",\n"date":1485948110000,\n"pictureList":[\n"http://static.oschina.net/uploads/user/1218/2437072_100.jpg?t=1461076033000",\n"http://common.cnblogs.com/images/icon_weibo_24.png"\n]\n},\n"code":200,\n"msg":"success"\n}\n')])])]),r._v(" "),t("br"),r._v(" "),t("h4",{attrs:{id:"获取用户列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取用户列表"}},[r._v("#")]),r._v(" 获取用户列表")]),r._v(" "),t("p",[r._v("请求：\n"),t("pre",[t("code",{staticClass:"language-json"},[r._v('{\n"[]":{\n   "count":3,             //只要3个\n   "User":{\n     "@column":"id,name"  //只要id,name这两个字段\n   }\n}\n}\n')])])]),r._v(" "),t("p",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22count%22:3,%22User%22:%7B%22@column%22:%22id,name%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("点击这里测试"),t("OutboundLink")],1)]),r._v(" "),t("p",[r._v("返回：\n"),t("pre",[t("code",{staticClass:"language-json"},[r._v('{\n"[]":[\n{\n"User":{\n"id":38710,\n"name":"TommyLemon"\n}\n},\n{\n"User":{\n"id":70793,\n"name":"Strong"\n}\n},\n{\n"User":{\n"id":82001,\n"name":"Android"\n}\n}\n],\n"code":200,\n"msg":"success"\n}\n')])])]),r._v(" "),t("br"),r._v(" "),t("h4",{attrs:{id:"获取动态及发布者用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取动态及发布者用户"}},[r._v("#")]),r._v(" 获取动态及发布者用户")]),r._v(" "),t("p",[r._v("请求：\n"),t("pre",[t("code",{staticClass:"language-json"},[r._v('{\n"Moment":{\n},\n"User":{\n"id@":"Moment/userId"  //User.id = Moment.userId\n}\n}\n')])])]),r._v(" "),t("p",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22Moment%22:%7B%7D,%22User%22:%7B%22id@%22:%22Moment%252FuserId%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("点击这里测试"),t("OutboundLink")],1)]),r._v(" "),t("p",[r._v("返回：\n"),t("pre",[t("code",{staticClass:"language-json"},[r._v('{\n"Moment":{\n"id":12,\n"userId":70793,\n"date":"2017-02-08 16:06:11.0",\n"content":"1111534034"\n},\n"User":{\n"id":70793,\n"sex":0,\n"name":"Strong",\n"tag":"djdj",\n"head":"http://static.oschina.net/uploads/user/585/1170143_50.jpg?t=1390226446000",\n"contactIdList":[\n38710,\n82002\n],\n"date":"2017-02-01 19:21:50.0"\n},\n"code":200,\n"msg":"success"\n}\n')])])]),r._v(" "),t("br"),r._v(" "),t("h4",{attrs:{id:"获取类似微信朋友圈的动态列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取类似微信朋友圈的动态列表"}},[r._v("#")]),r._v(" 获取类似微信朋友圈的动态列表")]),r._v(" "),t("p",[r._v("请求：\n"),t("pre",[t("code",{staticClass:"language-json"},[r._v('{\n"[]":{                             //请求一个数组\n"page":0,                        //数组条件\n"count":2,\n"Moment":{                       //请求一个名为Moment的对象\n"content$":"%a%"               //对象条件，搜索content中包含a的动态\n},\n"User":{\n     "id@":"/Moment/userId",        //User.id = Moment.userId  缺省引用赋值路径，从所处容器的父容器路径开始\n"@column":"id,name,head"       //指定返回字段\n},\n"Comment[]":{                    //请求一个名为Comment的数组，并去除Comment包装\n"count":2,\n"Comment":{\n"momentId@":"[]/Moment/id"   //Comment.momentId = Moment.id  完整引用赋值路径\n}\n}\n}\n}\n')])])]),r._v(" "),t("p",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22page%22:0,%22count%22:2,%22Moment%22:%7B%22content$%22:%22%2525a%2525%22%7D,%22User%22:%7B%22id@%22:%22%252FMoment%252FuserId%22,%22@column%22:%22id,name,head%22%7D,%22Comment%5B%5D%22:%7B%22count%22:2,%22Comment%22:%7B%22momentId@%22:%22%5B%5D%252FMoment%252Fid%22%7D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("点击这里测试"),t("OutboundLink")],1)]),r._v(" "),t("p",[r._v("返回：\n"),t("pre",[t("code",{staticClass:"language-json"},[r._v('{\n"[]":[\n{\n"Moment":{\n"id":15,\n"userId":70793,\n"date":1486541171000,\n"content":"APIJSON is a JSON Transmission Structure Protocol…",\n"praiseUserIdList":[\n82055,\n82002,\n82001\n],\n"pictureList":[\n"http://static.oschina.net/uploads/user/1218/2437072_100.jpg?t=1461076033000",\n"http://common.cnblogs.com/images/icon_weibo_24.png"\n]\n},\n"User":{\n"id":70793,\n"name":"Strong",\n"head":"http://static.oschina.net/uploads/user/585/1170143_50.jpg?t=1390226446000"\n},\n"Comment[]":[\n{\n"id":176,\n"toId":166,\n"userId":38710,\n"momentId":15,\n"date":1490444883000,\n"content":"thank you"\n},\n{\n"id":1490863469638,\n"toId":0,\n"userId":82002,\n"momentId":15,\n"date":1490863469000,\n"content":"Just do it"\n}\n]\n},\n{\n"Moment":{\n"id":58,\n"userId":90814,\n"date":1485947671000,\n"content":"This is a Content...-435",\n"praiseUserIdList":[\n38710,\n82003,\n82005,\n93793,\n82006,\n82044,\n82001\n],\n"pictureList":[\n"http://static.oschina.net/uploads/img/201604/22172507_aMmH.jpg"\n]\n},\n"User":{\n"id":90814,\n"name":7,\n"head":"http://static.oschina.net/uploads/user/51/102723_50.jpg?t=1449212504000"\n},\n"Comment[]":[\n{\n"id":13,\n"toId":0,\n"userId":82005,\n"momentId":58,\n"date":1485948050000,\n"content":"This is a Content...-13"\n},\n{\n"id":77,\n"toId":13,\n"userId":93793,\n"momentId":58,\n"date":1485948050000,\n"content":"This is a Content...-77"\n}\n]\n}\n],\n"code":200,\n"msg":"success"\n}\n')])])]),r._v(" "),t("br"),r._v(" "),t("p",[t("a",{attrs:{href:"http://apijson.org/auto",target:"_blank",rel:"noopener noreferrer"}},[r._v("在线测试"),t("OutboundLink")],1)]),r._v(" "),t("br"),r._v(" "),t("br"),r._v(" "),t("h2",{attrs:{id:"_2-对比传统restful方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-对比传统restful方式"}},[r._v("#")]),r._v(" "),t("h2",{attrs:{id:"2"}},[r._v("2.对比传统RESTful方式"),t("h2")]),r._v(" "),t("h3",{attrs:{id:"_2-1-开发流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-开发流程"}},[r._v("#")]),r._v(" "),t("h3",{attrs:{id:"2.1"}},[r._v("2.1 开发流程"),t("h3")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[r._v("开发流程")]),r._v(" "),t("th",[r._v("传统方式")]),r._v(" "),t("th",[r._v("APIJSON")])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("接口传输")]),r._v(" "),t("td",[r._v("等后端编辑接口，然后更新文档，前端再按照文档编辑请求和解析代码")]),r._v(" "),t("td",[r._v("前端按照自己的需求编辑请求和解析代码。"),t("br"),r._v("没有接口，更不需要文档！前端再也不用和后端沟通接口或文档问题了！")])]),r._v(" "),t("tr",[t("td",[r._v("兼容旧版")]),r._v(" "),t("td",[r._v("后端增加新接口，用v2表示第2版接口，然后更新文档")]),r._v(" "),t("td",[r._v("什么都不用做！")])])])]),r._v(" "),t("br"),r._v(" "),t("h3",{attrs:{id:"_2-2-前端请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-前端请求"}},[r._v("#")]),r._v(" "),t("h3",{attrs:{id:"2.2"}},[r._v("2.2 前端请求"),t("h3")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[r._v("前端请求")]),r._v(" "),t("th",[r._v("传统方式")]),r._v(" "),t("th",[r._v("APIJSON")])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("要求")]),r._v(" "),t("td",[r._v("前端按照文档在对应URL后面拼接键值对")]),r._v(" "),t("td",[r._v("前端按照自己的需求在固定URL后拼接JSON")])]),r._v(" "),t("tr",[t("td",[r._v("URL")]),r._v(" "),t("td",[r._v("不同的请求对应不同的URL，基本上有多少个不同的请求就得有多少个接口URL")]),r._v(" "),t("td",[r._v("相同的操作方法(增删改查)都用同一个URL，"),t("br"),r._v("大部分请求都用7个通用接口URL的其中一个")])]),r._v(" "),t("tr",[t("td",[r._v("键值对")]),r._v(" "),t("td",[r._v("key=value")]),r._v(" "),t("td",[r._v("key:value")])]),r._v(" "),t("tr",[t("td",[r._v("结构")]),r._v(" "),t("td",[r._v("同一个URL内table_name只能有一个 "),t("br"),t("br"),r._v(" base_url/get/table_name?"),t("br"),r._v("key0=value0&key1=value1...")]),r._v(" "),t("td",[r._v("同一个URL后TableName可传任意数量个 "),t("br"),t("br"),r._v(" base_url/get/"),t("br"),r._v("{"),t("br"),r._v("    TableName0:{"),t("br"),r._v("      key0:value0,"),t("br"),r._v("      key1:value1,"),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v("    TableName1:{"),t("br"),r._v("      ..."),t("br"),r._v("    }"),t("br"),r._v("    ..."),t("br"),r._v(" }")])])])]),r._v(" "),t("br"),r._v(" "),t("h3",{attrs:{id:"_2-3-后端操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-后端操作"}},[r._v("#")]),r._v(" "),t("h3",{attrs:{id:"2.3"}},[r._v("2.3 后端操作"),t("h3")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[r._v("后端操作")]),r._v(" "),t("th",[r._v("传统方式")]),r._v(" "),t("th",[r._v("APIJSON")])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("解析和返回")]),r._v(" "),t("td",[r._v("取出键值对，把键值对作为条件用预设的的方式去查询数据库，最后封装JSON并返回给前端")]),r._v(" "),t("td",[r._v("把Parser#parse方法的返回值返回给前端就行")])]),r._v(" "),t("tr",[t("td",[r._v("返回JSON结构的设定方式")]),r._v(" "),t("td",[r._v("由后端设定，前端不能修改")]),r._v(" "),t("td",[r._v("由前端设定，后端不能修改")])])])]),r._v(" "),t("br"),r._v(" "),t("h3",{attrs:{id:"_2-4-前端解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-前端解析"}},[r._v("#")]),r._v(" "),t("h3",{attrs:{id:"2.4"}},[r._v("2.4 前端解析"),t("h3")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[r._v("前端解析")]),r._v(" "),t("th",[r._v("传统方式")]),r._v(" "),t("th",[r._v("APIJSON")])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("查看方式")]),r._v(" "),t("td",[r._v("查文档或问后端，或等请求成功后看日志")]),r._v(" "),t("td",[r._v("看请求就行，所求即所得，不用查、不用问、不用等。也可以等请求成功后看日志")])]),r._v(" "),t("tr",[t("td",[r._v("解析方法")]),r._v(" "),t("td",[r._v("用JSON解析器来解析JSONObject")]),r._v(" "),t("td",[r._v("可以用JSONResponse解析JSONObject，或使用传统方式")])])])]),r._v(" "),t("br"),r._v(" "),t("h3",{attrs:{id:"_2-5-前端对应不同需求的请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-前端对应不同需求的请求"}},[r._v("#")]),r._v(" "),t("h3",{attrs:{id:"2.5"}},[r._v("2.5 前端对应不同需求的请求"),t("h3")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[r._v("前端的请求")]),r._v(" "),t("th",[r._v("传统方式")]),r._v(" "),t("th",[r._v("APIJSON")])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("User")]),r._v(" "),t("td",[r._v("base_url/get/user?id=38710")]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22id%22:38710%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("base_url/get/"),t("br"),r._v("{"),t("br"),r._v('    "User":{'),t("br"),r._v('      "id":38710'),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1)])]),r._v(" "),t("tr",[t("td",[r._v("Moment和对应的User")]),r._v(" "),t("td",[r._v("分两次请求"),t("br"),r._v("Moment: "),t("br"),r._v(" base_url/get/moment?userId=38710"),t("br"),t("br"),r._v("User: "),t("br"),r._v(" base_url/get/user?id=38710")]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22Moment%22:%7B%22userId%22:38710%7D,%22User%22:%7B%22id%22:38710%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("base_url/get/"),t("br"),r._v("{"),t("br"),r._v('    "Moment":{'),t("br"),r._v('      "userId":38710'),t("br"),r._v("    }, "),t("br"),r._v('    "User":{'),t("br"),r._v('      "id":38710'),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1)])]),r._v(" "),t("tr",[t("td",[r._v("User列表")]),r._v(" "),t("td",[r._v("base_url/get/user/list?"),t("br"),r._v("page=0&count=3&sex=0")]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22page%22:0,%22count%22:3,%22User%22:%7B%22sex%22:0%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("base_url/get/"),t("br"),r._v("{"),t("br"),r._v('    "User[]":{'),t("br"),r._v('      "page":0,'),t("br"),r._v('       "count":3, '),t("br"),r._v('      "User":{'),t("br"),r._v('        "sex":0'),t("br"),r._v("      }"),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1)])]),r._v(" "),t("tr",[t("td",[r._v("Moment列表，"),t("br"),r._v("每个Moment包括"),t("br"),r._v("1.发布者User"),t("br"),r._v("2.前3条Comment")]),r._v(" "),t("td",[r._v("Moment里必须有"),t("br"),r._v("1.User对象"),t("br"),r._v("2.Comment数组"),t("br"),t("br"),r._v(" base_url/get/moment/list?"),t("br"),r._v("page=0&count=3&commentCount=3")]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22page%22:0,%22count%22:3,%22Moment%22:%7B%7D,%22User%22:%7B%22id@%22:%22%252FMoment%252FuserId%22%7D,%22Comment%5B%5D%22:%7B%22count%22:3,%22Comment%22:%7B%22momentId@%22:%22%5B%5D%252FMoment%252Fid%22%7D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("base_url/get/"),t("br"),r._v("{"),t("br"),r._v('    "[]":{'),t("br"),r._v('      "page":0, '),t("br"),r._v('      "count":3, '),t("br"),r._v('      "Moment":{}, '),t("br"),r._v('      "User":{'),t("br"),r._v('        "id@":"/Moment/userId"'),t("br"),r._v("      },"),t("br"),r._v('      "Comment[]":{'),t("br"),r._v('        "count":3,'),t("br"),r._v('        "Comment":{'),t("br"),r._v('          "momentId@":"[]/Moment/id"'),t("br"),r._v("        }"),t("br"),r._v("      }"),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1)])]),r._v(" "),t("tr",[t("td",[r._v("User发布的Moment列表，"),t("br"),r._v(" 每个Moment包括"),t("br"),r._v(" 1.发布者User"),t("br"),r._v(" 2.前3条Comment")]),r._v(" "),t("td",[r._v("1.Moment里必须有User对象和Comment数组"),t("br"),r._v(" 2.字段名必须查接口文档，例如评论数量字段名可能是"),t("br"),r._v(" commentCount,comment_count或者简写cmt_count等各种奇葩写法... "),t("br"),t("br"),r._v(" base_url/get/moment/list?"),t("br"),r._v("page=0&count=3"),t("br"),r._v("&commentCount=3&userId=38710")]),r._v(" "),t("td",[r._v("有以下几种方式:"),t("br"),t("br"),r._v(" ① 把以上请求里的"),t("br"),r._v('"Moment":{}, "User":{"id@":"/Moment/userId"}'),t("br"),r._v("改为"),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22page%22:0,%22count%22:3,%22Moment%22:%7B%22userId%22:38710%7D,%22User%22:%7B%22id%22:38710%7D,%22Comment%5B%5D%22:%7B%22count%22:3,%22Comment%22:%7B%22momentId@%22:%22%5B%5D%252FMoment%252Fid%22%7D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"Moment":{"userId":38710}, "User":{"id":38710}'),t("OutboundLink")],1),r._v(" "),t("br"),t("br"),r._v(" ② 或把User放在上面的最外层省去重复的User"),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22id%22:38710%7D,%22%5B%5D%22:%7B%22page%22:0,%22count%22:3,%22Moment%22:%7B%22userId%22:38710%7D,%22Comment%5B%5D%22:%7B%22count%22:3,%22Comment%22:%7B%22momentId@%22:%22%5B%5D%252FMoment%252Fid%22%7D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("base_url/get/"),t("br"),r._v("{"),t("br"),r._v('    "User":{'),t("br"),r._v('      "id":38710'),t("br"),r._v("    },"),t("br"),r._v('    "[]":{'),t("br"),r._v('      "page":0,'),t("br"),r._v('      "count":3, '),t("br"),r._v('      "Moment":{'),t("br"),r._v('        "userId":38710'),t("br"),r._v("      }, "),t("br"),r._v('      "Comment[]":{'),t("br"),r._v('        "count":3,'),t("br"),r._v('        "Comment":{'),t("br"),r._v('          "momentId@":"[]/Moment/id"'),t("br"),r._v("        }"),t("br"),r._v("      }"),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1),t("br"),t("br"),r._v(" ③ 如果User之前已经获取到了，还可以不传User来节省请求和返回数据的流量并提升速度"),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22page%22:0,%22count%22:3,%22Moment%22:%7B%22userId%22:38710%7D,%22Comment%5B%5D%22:%7B%22count%22:3,%22Comment%22:%7B%22momentId@%22:%22%5B%5D%252FMoment%252Fid%22%7D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v("base_url/get/"),t("br"),r._v("{"),t("br"),r._v('    "[]":{'),t("br"),r._v('      "page":0,'),t("br"),r._v('      "count":3, '),t("br"),r._v('      "Moment":{'),t("br"),r._v('        "userId":38710'),t("br"),r._v("      },"),t("br"),r._v('      "Comment[]":{'),t("br"),r._v('        "count":3,'),t("br"),r._v('        "Comment":{'),t("br"),r._v('          "momentId@":"[]/Moment/id"'),t("br"),r._v("        }"),t("br"),r._v("      }"),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1)])])])]),r._v(" "),t("br"),r._v(" "),t("h3",{attrs:{id:"_2-6-后端对应不同请求的返回结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-后端对应不同请求的返回结果"}},[r._v("#")]),r._v(" "),t("h3",{attrs:{id:"2.6"}},[r._v("2.6 后端对应不同请求的返回结果"),t("h3")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[r._v("后端的返回结果")]),r._v(" "),t("th",[r._v("传统方式")]),r._v(" "),t("th",[r._v("APIJSON")])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("User")]),r._v(" "),t("td",[r._v("{"),t("br"),r._v('    "data":{'),t("br"),r._v('      "id":38710,'),t("br"),r._v('      "name":"xxx",'),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")]),r._v(" "),t("td",[r._v("{"),t("br"),r._v('    "User":{'),t("br"),r._v('      "id":38710,'),t("br"),r._v('      "name":"xxx",'),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")])]),r._v(" "),t("tr",[t("td",[r._v("Moment和对应的User")]),r._v(" "),t("td",[r._v("分别返回两次请求的结果，获取到Moment后取出userId作为User的id条件去查询User "),t("br"),t("br"),r._v(" Moment: "),t("br"),r._v(" {"),t("br"),r._v('    "data":{'),t("br"),r._v('      "id":235,'),t("br"),r._v('      "content":"xxx",'),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("} "),t("br"),t("br"),r._v(" User: "),t("br"),r._v(" {"),t("br"),r._v('    "data":{'),t("br"),r._v('      "id":38710,'),t("br"),r._v('      "name":"xxx",'),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")]),r._v(" "),t("td",[r._v("一次性返回，没有传统方式导致的 长时间等待结果、两次结果间关联、线程多次切换 等问题 "),t("br"),t("br"),r._v(" {"),t("br"),r._v('    "Moment":{'),t("br"),r._v('      "id":235,'),t("br"),r._v('      "content":"xxx",'),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v('    "User":{'),t("br"),r._v('      "id":38710,'),t("br"),r._v('      "name":"xxx",'),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")])]),r._v(" "),t("tr",[t("td",[r._v("User列表")]),r._v(" "),t("td",[r._v("{"),t("br"),r._v('    "data":['),t("br"),r._v("      {"),t("br"),r._v('        "id":38710,'),t("br"),r._v('        "name":"xxx",'),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      {"),t("br"),r._v('        "id":82001,'),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      ..."),t("br"),r._v("    ],"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")]),r._v(" "),t("td",[r._v("{"),t("br"),r._v('    "User[]":['),t("br"),r._v("      {"),t("br"),r._v('        "id":38710,'),t("br"),r._v('        "name":"xxx",'),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      {"),t("br"),r._v('        "id":82001,'),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      ..."),t("br"),r._v("    ],"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")])]),r._v(" "),t("tr",[t("td",[r._v("Moment列表，每个Moment包括发布者User和前3条Comment")]),r._v(" "),t("td",[r._v("Moment里必须有"),t("br"),r._v("1.User对象"),t("br"),r._v("2.Comment数组 "),t("br"),t("br"),r._v(" {"),t("br"),r._v('    "data":['),t("br"),r._v("      {"),t("br"),r._v('        "id":235,'),t("br"),r._v('        "content":"xxx",'),t("br"),r._v("        ...,"),t("br"),r._v('        "User":{'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("      },"),t("br"),r._v("      {"),t("br"),r._v('        "id":301,'),t("br"),r._v('        "content":"xxx",'),t("br"),r._v("        ...,"),t("br"),r._v('        "User":{'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      ..."),t("br"),r._v("    ],"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")]),r._v(" "),t("td",[r._v("1.高灵活，可任意组合"),t("br"),r._v("2.低耦合，逻辑很清晰"),t("br"),t("br"),r._v("{"),t("br"),r._v('    "[]":['),t("br"),r._v("      {"),t("br"),r._v('        "Moment":{'),t("br"),r._v('          "id":235,'),t("br"),r._v('          "content":"xxx",'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "User":{'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment[]":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("      },"),t("br"),r._v("      {"),t("br"),r._v('        "Moment":{'),t("br"),r._v('          "id":301,'),t("br"),r._v('          "content":"xxx",'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "User":{'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      ..."),t("br"),r._v("    ],"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")])]),r._v(" "),t("tr",[t("td",[r._v("User发布的Moment列表，每个Moment包括发布者User和前3条Comment")]),r._v(" "),t("td",[r._v("1.大量重复User，浪费流量和服务器性能"),t("br"),r._v("2.优化很繁琐，需要后端扩展接口、写好文档，前端/前端再配合优化"),t("br"),t("br"),r._v("{"),t("br"),r._v('    "data":['),t("br"),r._v("      {"),t("br"),r._v('        "id":235,'),t("br"),r._v('        "content":"xxx",'),t("br"),r._v("        ...,"),t("br"),r._v('        "User":{'),t("br"),r._v('          "id":38710,'),t("br"),r._v('          "name":"Tommy"'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      {"),t("br"),r._v('        "id":470,'),t("br"),r._v('        "content":"xxx",'),t("br"),r._v("        ...,"),t("br"),r._v('        "User":{'),t("br"),r._v('          "id":38710,'),t("br"),r._v('          "name":"Tommy"'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      {"),t("br"),r._v('        "id":511,'),t("br"),r._v('        "content":"xxx",'),t("br"),r._v("        ...,"),t("br"),r._v('        "User":{'),t("br"),r._v('          "id":38710,'),t("br"),r._v('          "name":"Tommy"'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      {"),t("br"),r._v('        "id":595,'),t("br"),r._v('        "content":"xxx",'),t("br"),r._v("        ...,"),t("br"),r._v('        "User":{'),t("br"),r._v('          "id":38710,'),t("br"),r._v('          "name":"Tommy"'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("        ..."),t("br"),r._v("      },"),t("br"),r._v("      ..."),t("br"),r._v("    ],"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")]),r._v(" "),t("td",[r._v("以上不同请求方式的结果:"),t("br"),t("br"),r._v(" ① 常规请求 "),t("br"),r._v(" {"),t("br"),r._v('    "[]":['),t("br"),r._v("      {"),t("br"),r._v('        "Moment":{'),t("br"),r._v('          "id":235,'),t("br"),r._v('          "content":"xxx",'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "User":{'),t("br"),r._v('          "id":38710,'),t("br"),r._v('          "name":"Tommy"'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment[]":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("      },"),t("br"),r._v("      ..."),t("br"),r._v("    ],"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}"),t("br"),t("br"),r._v(" ② 省去重复的User "),t("br"),r._v(" {"),t("br"),r._v('    "User":{'),t("br"),r._v('      "id":38710,'),t("br"),r._v('      "name":"Tommy",'),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v('    "[]":['),t("br"),r._v("      {"),t("br"),r._v('        "Moment":{'),t("br"),r._v('          "id":235,'),t("br"),r._v('          "content":"xxx",'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment[]":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("      },"),t("br"),r._v("      ..."),t("br"),r._v("    ],"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}"),t("br"),t("br"),r._v(" ③ 不查询已获取到的User "),t("br"),r._v(" {"),t("br"),r._v('    "[]":['),t("br"),r._v("      {"),t("br"),r._v('        "Moment":{'),t("br"),r._v('          "id":235,'),t("br"),r._v('          "content":"xxx",'),t("br"),r._v("          ..."),t("br"),r._v("        },"),t("br"),r._v('        "Comment[]":['),t("br"),r._v("          ..."),t("br"),r._v("        ]"),t("br"),r._v("      },"),t("br"),r._v("      ..."),t("br"),r._v("    ],"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")])])])]),r._v(" "),t("p",[r._v("1.base_url指基地址，一般是顶级域名，其它分支url都是在base_url后扩展。如base_url:http://apijson.cn:8080/ ，对应的GET分支url:http://apijson.cn:8080/get/ 。下同。"),t("br"),r._v("\n2.请求中的key或value任意一个为null值时，这个 key:value键值对 被视为无效。下同。"),t("br"),r._v("\n3.请求中的 / 需要转义。JSONRequest.java已经用URLEncoder.encode转义，不需要再写；但如果是浏览器或Postman等直接输入url/request，需要把request中的所有 / 都改成 %252F 。下同。"),t("br"),r._v("\n4.code，指返回结果中的状态码，200表示成功，其它都是错误码，值全部都是HTTP标准状态码。下同。"),t("br"),r._v("\n5.msg，指返回结果中的状态信息，对成功结果或错误原因的详细说明。下同。"),t("br"),r._v("\n6.code和msg总是在返回结果的同一层级成对出现。对所有请求的返回结果都会在最外层有一对总结式code和msg。下同。"),t("br"),r._v("\n7.id等字段对应的值仅供说明，不一定是数据库里存在的，请求里用的是真实存在的值。下同。")]),r._v(" "),t("br"),r._v(" "),t("br"),r._v(" "),t("h2",{attrs:{id:"_3-设计规范-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-设计规范-2"}},[r._v("#")]),r._v(" "),t("h2",{attrs:{id:"3"}},[r._v("3.设计规范"),t("h2")]),r._v(" "),t("h3",{attrs:{id:"_3-1-操作方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-操作方法"}},[r._v("#")]),r._v(" "),t("h3",{attrs:{id:"3.1"}},[r._v("3.1 操作方法"),t("h3")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[r._v("方法及说明")]),r._v(" "),t("th",[r._v("URL")]),r._v(" "),t("th",[r._v("Request")]),r._v(" "),t("th",[r._v("Response")])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("GET: "),t("br"),r._v(" 普通获取数据，"),t("br"),r._v(" 可用浏览器调试")]),r._v(" "),t("td",[r._v("base_url/get/")]),r._v(" "),t("td",[r._v("{"),t("br"),r._v("    TableName:{"),t("br"),r._v("      … "),t("br"),r._v("    }"),t("br"),r._v("} "),t("br"),r._v(" {…}内为限制条件"),t("br"),t("br"),r._v(" 例如获取一个 id = 235 的 Moment："),t("br"),r._v("{"),t("br"),r._v('    "Moment":{'),t("br"),r._v('      "id":235'),t("br"),r._v("    }"),t("br"),r._v("} "),t("br"),r._v(" 后端校验通过后自动解析为 SQL 并执行："),t("br"),t("code",[r._v("SELECT * FROM Moment WHERE id=235 LIMIT 1")])]),r._v(" "),t("td",[r._v("{"),t("br"),r._v("    TableName:{"),t("br"),r._v("      ..."),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}"),t("br"),r._v("例如"),t("br"),r._v("{"),t("br"),r._v('    "Moment":{'),t("br"),r._v('      "id":235,'),t("br"),r._v('      "userId":38710,'),t("br"),r._v('      "content":"APIJSON,let interfaces and documents go to hell !"'),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v(" }")])]),r._v(" "),t("tr",[t("td",[r._v("HEAD: "),t("br"),r._v(" 普通获取数量，"),t("br"),r._v(" 可用浏览器调试")]),r._v(" "),t("td",[r._v("base_url/head/")]),r._v(" "),t("td",[r._v("{"),t("br"),r._v("    TableName:{"),t("br"),r._v("      …"),t("br"),r._v("    }"),t("br"),r._v(" } "),t("br"),r._v(" {…}内为限制条件 "),t("br"),t("br"),r._v(" 例如获取一个 id = 38710 的 User 所发布的 Moment 总数："),t("br"),r._v("{"),t("br"),r._v('    "Moment":{'),t("br"),r._v('      "userId":38710'),t("br"),r._v("    }"),t("br"),r._v("} "),t("br"),r._v(" 后端校验通过后自动解析为 SQL 并执行："),t("br"),t("code",[r._v("SELECT count(*) FROM Moment WHERE userId=38710 LIMIT 1")])]),r._v(" "),t("td",[r._v("{"),t("br"),r._v("    TableName:{"),t("br"),r._v('      "code":200,'),t("br"),r._v('      "msg":"success",'),t("br"),r._v('      "count":10'),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("} "),t("br"),r._v(" 例如"),t("br"),r._v("{"),t("br"),r._v('    "Moment":{'),t("br"),r._v('      "code":200,'),t("br"),r._v('      "msg":"success",'),t("br"),r._v('      "count":10'),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('     "msg":"success"'),t("br"),r._v("}")])]),r._v(" "),t("tr",[t("td",[r._v("GETS: "),t("br"),r._v(" 安全/私密获取数据，"),t("br"),r._v(" 用于获取钱包等"),t("br"),r._v("对安全性要求高的数据")]),r._v(" "),t("td",[r._v("base_url/gets/")]),r._v(" "),t("td",[r._v('最外层加一个 "tag":tag，其它同GET')]),r._v(" "),t("td",[r._v("同GET")])]),r._v(" "),t("tr",[t("td",[r._v("HEADS: "),t("br"),r._v(" 安全/私密获取数量，"),t("br"),r._v(" 用于获取银行卡数量等"),t("br"),r._v("对安全性要求高的数据总数")]),r._v(" "),t("td",[r._v("base_url/heads/")]),r._v(" "),t("td",[r._v('最外层加一个 "tag":tag，其它同HEAD')]),r._v(" "),t("td",[r._v("同HEAD")])]),r._v(" "),t("tr",[t("td",[r._v("POST: "),t("br"),r._v(" 新增数据")]),r._v(" "),t("td",[r._v("base_url/post/")]),r._v(" "),t("td",[r._v("单个： "),t("br"),r._v(" {"),t("br"),r._v("    TableName:{"),t("br"),r._v("      …"),t("br"),r._v("    },"),t("br"),r._v('    "tag":tag'),t("br"),r._v("} "),t("br"),r._v(" {…}中id由后端生成，不能传 "),t("br"),t("br"),r._v("例如当前登录用户 38710 发布一个新 Comment："),t("br"),r._v("{"),t("br"),r._v('    "Comment":{'),t("br"),r._v('      "momentId":12,'),t("br"),r._v('      "content":"APIJSON,let interfaces and documents go to hell !" '),t("br"),r._v("    },"),t("br"),r._v('    "tag":"Comment"'),t("br"),r._v("} "),t("br"),r._v(" 后端校验通过后自动解析为 SQL 并执行："),t("br"),t("code",[r._v("INSERT INTO Comment(userId,momentId,content) VALUES(38710,12,'APIJSON,let interfaces and documents go to hell !')")]),r._v(" "),t("br"),r._v(" "),t("br"),r._v(" 批量： "),t("br"),r._v(" {"),t("br"),r._v("    TableName[]:[{"),t("br"),r._v("        …"),t("br"),r._v("      }, {"),t("br"),r._v("        …"),t("br"),r._v("      }"),t("br"),r._v("      …"),t("br"),r._v("    ],"),t("br"),r._v('    "tag":tag'),t("br"),r._v("} "),t("br"),r._v(" {…}中id由后端生成，不能传 "),t("br"),t("br"),r._v("例如当前登录用户 82001 发布 2 个 Comment："),t("br"),r._v("{"),t("br"),r._v('    "Comment[]":[{'),t("br"),r._v('      "momentId":12,'),t("br"),r._v('      "content":"APIJSON,let interfaces and documents go to hell !"'),t("br"),r._v("      }, {"),t("br"),r._v('      "momentId":15,'),t("br"),r._v('      "content":"APIJSON is a JSON transmision protocol."'),t("br"),r._v("    }],"),t("br"),r._v('    "tag":"Comment:[]"'),t("br"),r._v("}"),t("br"),r._v("  后端校验通过后自动解析为 SQL 并执行："),t("br"),t("code",[r._v("INSERT INTO Comment(userId,momentId,content) VALUES(82001,12,'APIJSON,let interfaces and documents go to hell !')")]),t("br"),t("code",[r._v("INSERT INTO Comment(userId,momentId,content) VALUES(82001,15,'APIJSON is a JSON transmision protocol.')")])]),r._v(" "),t("td",[r._v("单个： "),t("br"),r._v(" {"),t("br"),r._v("    TableName:{"),t("br"),r._v('      "code":200,'),t("br"),r._v('      "msg":"success",'),t("br"),r._v('      "id":38710'),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}"),t("br"),r._v("例如"),t("br"),r._v("{"),t("br"),r._v('    "Comment":{'),t("br"),r._v('      "code":200,'),t("br"),r._v('      "msg":"success",'),t("br"),r._v('      "id":120'),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("} "),t("br"),r._v(" "),t("br"),r._v(" 批量： "),t("br"),r._v(" {"),t("br"),r._v("    TableName:{"),t("br"),r._v('      "code":200,'),t("br"),r._v('      "msg":"success",'),t("br"),r._v('      "count":5,'),t("br"),r._v('      "id[]":[1, 2, 3, 4, 5]'),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}"),t("br"),r._v("例如"),t("br"),r._v("{"),t("br"),r._v('    "Comment":{'),t("br"),r._v('      "code":200,'),t("br"),r._v('      "msg":"success",'),t("br"),r._v('      "count":2,'),t("br"),r._v('      "id[]":[1, 2]'),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}")])]),r._v(" "),t("tr",[t("td",[r._v("PUT: "),t("br"),r._v(" 修改数据，"),t("br"),r._v(" 只修改所传的字段")]),r._v(" "),t("td",[r._v("base_url/put/")]),r._v(" "),t("td",[r._v("{"),t("br"),r._v("    TableName:{"),t("br"),r._v('      "id":id,'),t("br"),r._v("      …"),t("br"),r._v("    },"),t("br"),r._v('    "tag":tag'),t("br"),r._v("} "),t("br"),r._v(" {…} 中 id 或 id{} 至少传一个 "),t("br"),t("br"),r._v("例如当前登录用户 82001 修改 id = 235 的 Moment 的 content："),t("br"),r._v("{"),t("br"),r._v('    "Moment":{'),t("br"),r._v('      "id":235,'),t("br"),r._v('      "content":"APIJSON,let interfaces and documents go to hell !"'),t("br"),r._v("    },"),t("br"),r._v('    "tag":"Moment"'),t("br"),r._v("} "),t("br"),r._v(" 后端校验通过后自动解析为 SQL 并执行："),t("br"),t("code",[r._v("UPDATE Moment SET content='APIJSON,let interfaces and documents go to hell !' WHERE id=235 AND userId=82001 LIMIT 1")]),r._v(" "),t("br"),t("br"),r._v(" 批量除了 id{}:[] 也可类似批量 POST，只是每个 {...} 里面都必须有 id。"),t("br"),r._v('"tag":"Comment[]" 对应对象 "Comment":{"id{}":[1,2,3]}，表示指定记录全部统一设置；'),t("br"),r._v('"tag":"Comment:[]" 多了冒号，对应数组 "Comment[]":[{"id":1},{"id":2},{"id":3}]，表示每项单独设置')]),r._v(" "),t("td",[r._v("同POST")])]),r._v(" "),t("tr",[t("td",[r._v("DELETE: "),t("br"),r._v(" 删除数据")]),r._v(" "),t("td",[r._v("base_url/delete/")]),r._v(" "),t("td",[r._v("{"),t("br"),r._v("    TableName:{"),t("br"),r._v('      "id":id'),t("br"),r._v("    },"),t("br"),r._v('    "tag":tag'),t("br"),r._v("} "),t("br"),r._v(" {…} 中 id 或 id{} 至少传一个，一般只传 id 或 id{} "),t("br"),t("br"),r._v("例如当前登录用户 82001 批量删除 id = 100,110,120 的 Comment："),t("br"),r._v("{"),t("br"),r._v('    "Comment":{'),t("br"),r._v('      "id{}":[100,110,120]'),t("br"),r._v("    },"),t("br"),r._v('    "tag":"Comment[]"'),t("br"),r._v("} "),t("br"),r._v(" 后端校验通过后自动解析为 SQL 并执行："),t("br"),t("code",[r._v("DELETE FROM Comment WHERE id IN(100,110,120) AND userId=82001 LIMIT 3")])]),r._v(" "),t("td",[r._v("{"),t("br"),r._v("    TableName:{"),t("br"),r._v('      "code":200,'),t("br"),r._v('      "msg":"success",'),t("br"),r._v('      "id[]":[100,110,120]'),t("br"),r._v('      "count":3'),t("br"),r._v("    },"),t("br"),r._v('    "code":200,'),t("br"),r._v('    "msg":"success"'),t("br"),r._v("}"),t("br"),r._v("例如"),t("br"),r._v("{"),t("br"),r._v('   "Comment":{'),t("br"),r._v('      "code":200,'),t("br"),r._v('      "msg":"success",'),t("br"),r._v('      "id[]":[100,110,120],'),t("br"),r._v('      "count":3'),t("br"),r._v("   },"),t("br"),r._v('   "code":200,'),t("br"),r._v('   "msg":"success"'),t("br"),r._v("}")])])])]),r._v(" "),t("p",[r._v("1.TableName指要查询的数据库表Table的名称字符串。第一个字符为大写字母，剩下的字符要符合英语字母、数字、下划线中的任何一种。对应的值的类型为JSONObject，结构是 {...}，里面放的是Table的字段(列名)。下同。"),t("br"),r._v('\n2."tag":tag 后面的tag是非GET、HEAD请求中匹配请求的JSON结构的标识，一般是要查询的table的名称，由后端Request表中指定。下同。'),t("br"),r._v("\n3.GET、HEAD请求是开放请求，可任意组合任意嵌套。其它请求为受限制的安全/私密请求，对应的 方法（method）, 标识（tag）, 版本（version）, 结构（structure） 都必须和 后端Request表中所指定的 一一对应，否则请求将不被通过。version 不传、为 null 或 <=0 都会使用最高版本，传了其它有效值则会使用最接近它的最低版本。下同。"),t("br"),r._v("\n4.GETS与GET、HEADS与HEAD分别为同一类型的操作方法，请求稍有不同但返回结果相同。下同。"),t("br"),r._v("\n5.在HTTP通信中，自动化接口(get,gets,head,heads,post,put,delete) 全用HTTP POST请求。下同。"),t("br"),r._v("\n6.所有JSONObject都视为容器(或者文件夹)，结构为 {...} ，里面可以放普通对象或子容器。下同。"),t("br"),r._v("\n7.每个对象都有一个唯一的路径(或者叫地址)，假设对象名为refKey，则用 key0/key1/.../refKey 表示。下同。")]),r._v(" "),t("br"),r._v(" "),t("h3",{attrs:{id:"_3-2-功能符"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-功能符"}},[r._v("#")]),r._v(" "),t("h3",{attrs:{id:"3.2"}},[r._v("3.2 功能符"),t("h3")]),r._v(" "),t("table",[t("thead",[t("tr",[t("th",[r._v("功能")]),r._v(" "),t("th",[r._v("键值对格式")]),r._v(" "),t("th",[r._v("使用示例")])])]),r._v(" "),t("tbody",[t("tr",[t("td",[r._v("查询数组")]),r._v(" "),t("td",[r._v('"key[]":{}，后面是JSONObject，key可省略。当key和里面的Table名相同时，Table会被提取出来，即 {Table:{Content}} 会被转化为 {Content}')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22count%22:3,%22User%22:%7B%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('{"User[]":{"User":{}}}'),t("OutboundLink")],1),r._v('，查询一个User数组。这里key和Table名都是User，User会被提取出来，即 {"User":{"id", ...}} 会被转化为 {"id", ...}，如果要进一步提取User中的id，可以把User[]改为User-id[]')])]),r._v(" "),t("tr",[t("td",[r._v("匹配选项范围")]),r._v(" "),t("td",[r._v('"key{}":[]，后面是JSONArray，作为key可取的值的选项')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22count%22:3,%22User%22:%7B%22id%7B%7D%22:%5B38710,82001,70793%5D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id{}":[38710,82001,70793]'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("id IN(38710,82001,70793)")]),r._v("，查询id符合38710,82001,70793中任意一个的一个User数组")])]),r._v(" "),t("tr",[t("td",[r._v("匹配条件范围")]),r._v(" "),t("td",[r._v('"key{}":"条件0,条件1..."，条件为SQL表达式字符串，可进行数字比较运算等')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22count%22:3,%22User%22:%7B%22id%7B%7D%22:%22%3C=80000,%3E90000%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id{}":"<=80000,>90000"'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("id<=80000 OR id>90000")]),r._v("，查询id符合id<=80000 | id>90000的一个User数组")])]),r._v(" "),t("tr",[t("td",[r._v("包含选项范围")]),r._v(" "),t("td",[r._v('"key<>":Object  =>  "key<>":[Object]，key对应值的类型必须为JSONArray，Object类型不能为JSON')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22count%22:3,%22User%22:%7B%22contactIdList%3C%3E%22:38710%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"contactIdList<>":38710'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("json_contains(contactIdList,38710)")]),r._v("，查询contactIdList包含38710的一个User数组")])]),r._v(" "),t("tr",[t("td",[r._v("判断是否存在")]),r._v(" "),t("td",[r._v('"key}{@":{'),t("br"),r._v('    "from":"Table",'),t("br"),r._v('    "Table":{ ... }'),t("br"),r._v("}"),t("br"),r._v("其中："),t("br"),r._v("}{ 表示 EXISTS；"),t("br"),r._v(" key 用来标识是哪个判断；"),t("br"),r._v(" @ 后面是 子查询 对象，具体见下方 子查询 的说明。")]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22id%7D%7B@%22:%7B%22from%22:%22Comment%22,%22Comment%22:%7B%22momentId%22:15%7D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id}{@":{'),t("br"),r._v('    "from":"Comment",'),t("br"),r._v('    "Comment":{'),t("br"),r._v('        "momentId":15 '),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1),t("br"),r._v(" WHERE EXISTS(SELECT * FROM Comment WHERE momentId=15)")])]),r._v(" "),t("tr",[t("td",[r._v("远程调用函数")]),r._v(" "),t("td",[r._v('"key()":"函数表达式"，函数表达式为 function(key0,key1...)，会调用后端对应的函数 function(JSONObject request, String key0, String key1...)，实现 参数校验、数值计算、数据同步、消息推送、字段拼接、结构变换 等特定的业务逻辑处理，'),t("br"),r._v("可使用 - 和 + 表示优先级，解析 key-() > 解析当前对象 > 解析 key() > 解析子对象 > 解析 key+()")]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22Moment%22:%7B%22id%22:301,%22isPraised()%22:%22isContain(praiseUserIdList,userId)%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"isPraised()":"isContain(praiseUserIdList,userId)"'),t("OutboundLink")],1),r._v('，会调用远程函数 boolean isContain(JSONObject request, String array, String value) ，然后变为 "isPraised":true 这种（假设点赞用户id列表包含了userId，即这个User点了赞）')])]),r._v(" "),t("tr",[t("td",[r._v("存储过程")]),r._v(" "),t("td",[r._v('"@key()":"SQL函数表达式"，函数表达式为 '),t("br"),r._v("  function(key0,key1...) "),t("br"),r._v(" 会调用后端数据库对应的存储过程 SQL函数 "),t("br"),r._v(" function(String key0, String key1...) "),t("br"),r._v(" 除了参数会提前赋值，其它和 远程函数 一致")]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22@limit%22:10,%22@offset%22:0,%22@procedure()%22:%22getCommentByUserId(id,@limit,@offset)%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@limit":10, '),t("br"),r._v(' "@offset":0, '),t("br"),r._v(' "@procedure()":"getCommentByUserId(id,@limit,@offset)"'),t("OutboundLink")],1),r._v(" "),t("br"),r._v(" 会转为 "),t("br"),r._v(" "),t("code",[r._v("getCommentByUserId(38710,10,0)")]),r._v(" "),t("br"),r._v(" 来调用存储过程 SQL 函数 "),t("br"),r._v(" "),t("code",[r._v("getCommentByUserId(IN id bigint, IN limit int, IN offset int)")]),r._v(" "),t("br"),r._v(" 然后变为 "),t("br"),r._v('"procedure":{'),t("br"),r._v('    "count":-1, '),t("br"),r._v('    "update":false, '),t("br"),r._v('    "list":[] '),t("br"),r._v(" } "),t("br"),r._v(" 其中 count 是指写操作影响记录行数，-1 表示不是写操作；update 是指是否为写操作（增删改）；list 为返回结果集")])]),r._v(" "),t("tr",[t("td",[r._v("引用赋值")]),r._v(" "),t("td",[r._v('"key@":"key0/key1/.../refKey"，引用路径为用/分隔的字符串。以/开头的是缺省引用路径，从声明key所处容器的父容器路径开始；其它是完整引用路径，从最外层开始。'),t("br"),r._v(' 被引用的refKey必须在声明key的上面。如果对refKey的容器指定了返回字段，则被引用的refKey必须写在@column对应的值内，例如 "@column":"refKey,key1,..."')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22Moment%22:%7B%22userId%22:38710%7D,%22User%22:%7B%22id@%22:%22%252FMoment%252FuserId%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"Moment":{'),t("br"),r._v('    "userId":38710'),t("br"),r._v("},"),t("br"),r._v('"User":{'),t("br"),r._v('    "id@":"/Moment/userId"'),t("br"),r._v("}"),t("OutboundLink")],1),t("br"),r._v(" User内的id引用了与User同级的Moment内的userId，"),t("br"),r._v("即User.id = Moment.userId，请求完成后"),t("br"),r._v(' "id@":"/Moment/userId" 会变成 "id":38710')])]),r._v(" "),t("tr",[t("td",[r._v("子查询")]),r._v(" "),t("td",[r._v('"key@":{'),t("br"),r._v('    "range":"ALL", '),t("br"),r._v('    "from":"Table",'),t("br"),r._v('    "Table":{ ... }'),t("br"),r._v("}"),t("br"),r._v("其中："),t("br"),r._v("range 可为 ALL,ANY；"),t("br"),r._v("from 为目标表 Table 的名称；"),t("br"),r._v("@ 后面的对象类似数组对象，可使用 count 和 join 等功能。")]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22id@%22:%7B%22from%22:%22Comment%22,%22Comment%22:%7B%22@column%22:%22min(userId)%22%7D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id@":{'),t("br"),r._v('    "from":"Comment",'),t("br"),r._v('    "Comment":{'),t("br"),r._v('        "@column":"min(userId)" '),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1),t("br"),r._v(" WHERE id=(SELECT min(userId) FROM Comment)")])]),r._v(" "),t("tr",[t("td",[r._v("模糊搜索")]),r._v(" "),t("td",[r._v('"key$":"SQL搜索表达式"  =>  "key$":["SQL搜索表达式"]，任意SQL搜索表达式字符串，如 %key%(包含key), key%(以key开始), %k%e%y%(包含字母k,e,y) 等，%表示任意字符')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22count%22:3,%22User%22:%7B%22name$%22:%22%2525m%2525%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"name$":"%m%"'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("name LIKE '%m%'")]),r._v('，查询name包含"m"的一个User数组')])]),r._v(" "),t("tr",[t("td",[r._v("正则匹配")]),r._v(" "),t("td",[r._v('"key~":"正则表达式"  =>  "key~":["正则表达式"]，任意正则表达式字符串，如 ^[0-9]+$ ，*~ 忽略大小写，可用于高级搜索')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22count%22:3,%22User%22:%7B%22name~%22:%22%5E%5B0-9%5D%252B$%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"name~":"^[0-9]+$"'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("name REGEXP '^[0-9]+$'")]),r._v("，查询name中字符全为数字的一个User数组")])]),r._v(" "),t("tr",[t("td",[r._v("连续范围")]),r._v(" "),t("td",[r._v('"key%":"start,end"  =>  "key%":["start,end"]，其中 start 和 end 都只能为 Boolean, Number, String 中的一种，如 "2017-01-01,2019-01-01" ，["1,90000", "82001,100000"] ，可用于连续范围内的筛选')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22count%22:3,%22User%22:%7B%22date%2525%22:%222017-10-01,2018-10-01%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"date%":"2017-10-01,2018-10-01"'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("date BETWEEN '2017-10-01' AND '2018-10-01'")]),r._v("，查询在2017-10-01和2018-10-01期间注册的用户的一个User数组")])]),r._v(" "),t("tr",[t("td",[r._v("新建别名")]),r._v(" "),t("td",[r._v('"name:alias"，name映射为alias，用alias替代name。可用于 column,Table,SQL函数 等。只用于GET类型、HEAD类型的请求')]),r._v(" "),t("td",[t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22Comment%22:%7B%22@column%22:%22id,toId:parentId%22,%22id%22:51%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@column":"toId:parentId"'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("toId AS parentId")]),r._v("，将查询的字段toId变为parentId返回")])]),r._v(" "),t("tr",[t("td",[r._v("增加 或 扩展")]),r._v(" "),t("td",[r._v('"key+":Object，Object的类型由key指定，且类型为Number,String,JSONArray中的一种。如 82001,"apijson",["url0","url1"] 等。只用于PUT请求')]),r._v(" "),t("td",[r._v('"praiseUserIdList+":[82001]，对应SQL是'),t("code",[r._v("json_insert(praiseUserIdList,82001)")]),r._v("，添加一个点赞用户id，即这个用户点了赞")])]),r._v(" "),t("tr",[t("td",[r._v("减少 或 去除")]),r._v(" "),t("td",[r._v('"key-":Object，与"key+"相反')]),r._v(" "),t("td",[r._v('"balance-":100.00，对应SQL是'),t("code",[r._v("balance = balance - 100.00")]),r._v("，余额减少100.00，即花费了100元")])]),r._v(" "),t("tr",[t("td",[r._v("比较运算")]),r._v(" "),t("td",[r._v(">, <, >=, <= 比较运算符，用于 "),t("br"),r._v('① 提供 "id{}":"<=90000" 这种条件范围的简化写法 '),t("br"),t("br"),r._v("② 实现子查询相关比较运算"),t("br"),t("br"),r._v('不支持 "key=":Object 和 "key!=":Object 这两种写法，直接用更简单的 "key":Object 和 "key!":Object 替代。')]),r._v(" "),t("td",[r._v("① "),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22User%22:%7B%22id%3C=%22:90000%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id<=":90000'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("id<=90000")]),r._v("，查询符合id<=90000的一个User数组"),t("br"),t("br"),r._v(" ② "),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22id%3E@%22:%7B%22from%22:%22Comment%22,%22Comment%22:%7B%22@column%22:%22min(userId)%22%7D%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id>@":{'),t("br"),r._v('    "from":"Comment",'),t("br"),r._v('    "Comment":{'),t("br"),r._v('        "@column":"min(userId)" '),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1),t("br"),r._v(" WHERE id>(SELECT min(userId) FROM Comment)")])]),r._v(" "),t("tr",[t("td",[r._v("逻辑运算")]),r._v(" "),t("td",[r._v("&, |, ! 逻辑运算符，对应数据库 SQL 中的 AND, OR, NOT。 "),t("br"),r._v("横或纵与：同一键值对的值内条件默认 | 或连接，可以在 key 后加逻辑运算符来具体指定；不同键值对的条件默认 & 与连接，可以用下面说明的对象关键词 @combine 来具体指定。 "),t("br"),t("br"),r._v('① & 可用于"key&{}":"条件"等'),t("br"),t("br"),r._v('② | 可用于"key|{}":"条件", "key|{}":[]等，一般可省略'),t("br"),t("br"),r._v('③ ! 可单独使用，如"key!":Object，也可像&,|一样配合其他功能符使用 '),t("br"),r._v(' "key!":null 无效，null 值会导致整个键值对被忽略解析，可以用 "key{}":"!=null" 替代，'),t("br"),r._v('"key":null 同理，用 "key{}":"=null" 替代。')]),r._v(" "),t("td",[r._v("① "),t("a",{attrs:{href:"http://apijson.cn:8080/head/%7B%22User%22:%7B%22id&%7B%7D%22:%22%3E80000,%3C=90000%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id&{}":">80000,<=90000"'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("id>80000 AND id<=90000")]),r._v("，即id满足id>80000 & id<=90000"),t("br"),t("br"),r._v(" ② "),t("a",{attrs:{href:"http://apijson.cn:8080/head/%7B%22User%22:%7B%22id%7C%7B%7D%22:%22%3E90000,%3C=80000%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id|{}":">90000,<=80000"'),t("OutboundLink")],1),r._v('，同"id{}":">90000,<=80000"，对应SQL是'),t("code",[r._v("id>80000 OR id<=90000")]),r._v("，即id满足id>90000 | id<=80000"),t("br"),t("br"),r._v(" ③ "),t("a",{attrs:{href:"http://apijson.cn:8080/head/%7B%22User%22:%7B%22id!%7B%7D%22:%5B82001,38710%5D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"id!{}":[82001,38710]'),t("OutboundLink")],1),r._v("，对应SQL是"),t("code",[r._v("id NOT IN(82001,38710)")]),r._v("，即id满足 ! (id=82001 | id=38710)，可过滤黑名单的消息")])]),r._v(" "),t("tr",[t("td",[r._v("数组关键词，可自定义")]),r._v(" "),t("td",[r._v('"key":Object，key为 "[]":{} 中{}内的关键词，Object的类型由key指定'),t("br"),t("br"),r._v('① "count":Integer，查询数量，0 表示最大值，默认最大值为100 '),t("br"),t("br"),r._v('② "page":Integer，查询页码，从0开始，默认最大值为100，一般和count一起用'),t("br"),t("br"),r._v('③ "query":Integer，查询内容'),t("br"),r._v("0-对象，1-总数和分页详情，2-以上全部"),t("br"),r._v("总数关键词为 total，分页详情关键词为 info，"),t("br"),r._v(" 它们都和 query 同级，通过引用赋值得到，例如  "),t("br"),r._v('"total@":"/[]/total", "info@":"/[]/info" '),t("br"),r._v("这里query及total仅为GET类型的请求提供方便，"),t("br"),r._v(" 一般可直接用HEAD类型的请求获取总数"),t("br"),t("br"),r._v('④ "join":"&/Table0/key0@,</Table1/key1@"'),t("br"),r._v("多表连接方式："),t("br"),r._v(' "<" - LEFT JOIN '),t("br"),r._v(' ">" - RIGHT JOIN '),t("br"),r._v(' "&" - INNER JOIN '),t("br"),r._v(' "|" - FULL JOIN '),t("br"),r._v('  "!" - OUTER JOIN '),t("br"),r._v(' "@" - APP JOIN '),t("br"),r._v("其中 @ APP JOIN 为应用层连表，会从已查出的主表里取得所有副表 key@ 关联的主表内的 refKey 作为一个数组 refKeys: [value0, value1...]，然后把原来副表 count 次查询 key=$refKey 的 SQL 用 key IN($refKeys) 的方式合并为一条 SQL 来优化性能；"),t("br"),r._v(" 其它 JOIN 都是 SQL JOIN，具体功能和 MySQL,PostgreSQL 等数据库的 JOIN 一一对应 "),t("br"),t("code",[r._v('"join":"</ViceTable/key@",')]),t("br"),t("code",[r._v('"MainTable":{},')]),t("br"),t("code",[r._v('"ViceTable":{"key@":"/MainTable/refKey"}')]),t("br"),r._v("会对应生成 "),t("br"),t("code",[r._v("MainTable LEFT JOIN ViceTable")]),r._v(" "),t("br"),t("code",[r._v("ON ViceTable.key=MainTable.refKey")]),r._v(" "),t("br"),t("br"),r._v('⑤ "otherKey":Object，自定义关键词，名称和以上系统关键词不一样，且原样返回上传的值')]),r._v(" "),t("td",[r._v("① 查询User数组，最多5个："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22count%22:5,%22User%22:%7B%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"count":5'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("LIMIT 5")]),r._v(" "),t("br"),t("br"),r._v(" ② 查询第3页的User数组，每页5个："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22count%22:5,%22page%22:3,%22User%22:%7B%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"count":5,'),t("br"),r._v('"page":3'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("LIMIT 5 OFFSET 15")]),r._v(" "),t("br"),t("br"),r._v(" ③ 查询User数组和对应的User总数："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22query%22:2,%22count%22:5,%22User%22:%7B%7D%7D,%22total@%22:%22%252F%5B%5D%252Ftotal%22,%22info@%22:%22%252F%5B%5D%252Finfo%22%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"[]":{'),t("br"),r._v('    "query":2,'),t("br"),r._v('    "User":{}'),t("br"),r._v("},"),t("br"),r._v('"total@":"/[]/total",'),t("br"),r._v('"info@":"/[]/info"'),t("OutboundLink")],1),t("br"),r._v(" 返回的数据中，总数及分页详情结构为： "),t("br"),r._v('  "total":139,  //总数 '),t("br"),r._v(' "info":{  //分页详情 '),t("br"),r._v('    "total":139,  //总数 '),t("br"),r._v('    "count":5,  //每页数量 '),t("br"),r._v('    "page":0,  //当前页码 '),t("br"),r._v('    "max":27,  //最大页码 '),t("br"),r._v('    "more":true,  //是否还有更多 '),t("br"),r._v('    "first":true,  //是否为首页 '),t("br"),r._v('    "last":false  //是否为尾页 '),t("br"),r._v("} "),t("br"),t("br"),r._v(" ④ Moment INNER JOIN User LEFT JOIN Comment："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22count%22:5,%22join%22:%22&%252FUser%252Fid@,%3C%252FComment%252FmomentId@%22,%22Moment%22:%7B%22@column%22:%22id,userId,content%22,%22@group%22:%22id%22%7D,%22User%22:%7B%22name~%22:%22t%22,%22id@%22:%22%252FMoment%252FuserId%22,%22@column%22:%22id,name,head%22%7D,%22Comment%22:%7B%22momentId@%22:%22%252FMoment%252Fid%22,%22@column%22:%22id,momentId,content%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"[]":{'),t("br"),r._v('    "join":"&/User/id@,</Comment/momentId@",'),t("br"),r._v('    "Moment":{'),t("br"),r._v('     "@group":"id"  //主副表不是一对一，要去除重复数据'),t("br"),r._v("   },"),t("br"),r._v('    "User":{'),t("br"),r._v('      "name~":"t",'),t("br"),r._v('      "id@":"/Moment/userId"'),t("br"),r._v("    },"),t("br"),r._v('    "Comment":{'),t("br"),r._v('      "momentId@":"/Moment/id"'),t("br"),r._v("    }"),t("br"),r._v("}"),t("OutboundLink")],1),t("br"),t("br"),r._v(" ⑤ 每一层都加当前用户名："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%7D,%22%5B%5D%22:%7B%22name@%22:%22User%252Fname%22,%22Moment%22:%7B%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"User":{},'),t("br"),r._v('"[]":{'),t("br"),r._v('    "name@":"User/name", //自定义关键词'),t("br"),r._v('    "Moment":{}'),t("br"),r._v("}"),t("OutboundLink")],1)])]),r._v(" "),t("tr",[t("td",[r._v("对象关键词，可自定义")]),r._v(" "),t("td",[r._v('"@key":Object，@key为 Table:{} 中{}内的关键词，Object的类型由@key指定'),t("br"),t("br"),r._v('① "@combine":"&key0,&key1,|key2,key3,'),t("br"),r._v('!key4,!key5,&key6,key7..."，条件组合方式，| 可省略。会自动把同类的合并，外层按照 & | ! 顺序，内层的按传参顺序组合成'),t("br"),r._v(" (key0 & key1 & key6 & 其它key) & (key2 | key3 | key7) & !(key4 | key5) "),t("br"),r._v('这种连接方式，其中 "其它key" 是指与 @combine 在同一对象，且未被它声明的条件 key，默认都是 & 连接 '),t("br"),t("br"),r._v('② "@column":"column;function(arg)..."，返回字段'),t("br"),t("br"),r._v('③ "@order":"column0+,column1-..."，排序方式'),t("br"),t("br"),r._v('④ "@group":"column0,column1..."，分组方式。如果@column里声明了Table的id，则id也必须在@group中声明；其它情况下必须满足至少一个条件:'),t("br"),r._v("1.分组的key在@column里声明"),t("br"),r._v("2.Table主键在@group中声明 "),t("br"),t("br"),r._v('⑤ "@having":"function0(...)?value0;function1(...)?value1;function2(...)?value2..."，SQL函数条件，一般和@group一起用，函数一般在@column里声明'),t("br"),t("br"),r._v('⑥ "@schema":"sys"，集合空间(模式)，非默认的值可通过它来指定，可以在最外层作为全局默认配置'),t("br"),t("br"),r._v('⑦ "@database":"POSTGRESQL"，跨数据库，非默认的值可通过它来指定，可以在最外层作为全局默认配置'),t("br"),t("br"),r._v('⑧ "@json":"key0,key1..."，转为 JSON 格式返回，符合 JSONObject 则转为 {...}，符合 JSONArray 则转为 [...] '),t("br"),t("br"),r._v('⑨ "@role":"OWNER"，来访角色，包括'),t("br"),r._v("UNKNOWN,LOGIN,CONTACT,CIRCLE,OWNER,ADMIN，"),t("br"),r._v("可以在最外层作为全局默认配置，"),t("br"),r._v("可自定义其它角色并重写 Verifier.verify 等相关方法来自定义校验 "),t("br"),t("br"),r._v('⑩ "@explain":true，性能分析，可以在最外层作为全局默认配置 '),t("br"),t("br"),r._v('⑪ "@raw":"key0,key1..."，其中 key0, key1 都对应有键值对'),t("br"),r._v(' "key0":"SQL片段或SQL片段的别名", '),t("br"),r._v(' "key1":"SQL片段或SQL片段的别名" '),t("br"),r._v(" 自定义原始SQL片段，可扩展嵌套SQL函数等复杂语句，必须是后端已配置的，只有其它功能符都做不到才考虑，谨慎使用，注意防SQL注入"),t("br"),t("br"),r._v('⑫ "@otherKey":Object，自定义关键词，名称和以上系统关键词不一样，且原样返回上传的值')]),r._v(" "),t("td",[r._v("① 搜索name或tag任何一个字段包含字符a的User列表："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%5B%5D%22:%7B%22count%22:10,%22User%22:%7B%22@column%22:%22id,name,tag%22,%22name~%22:%22a%22,%22tag~%22:%22a%22,%22@combine%22:%22name~,tag~%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"name~":"a",'),t("br"),r._v('"tag~":"a",'),t("br"),r._v('"@combine":"name~,tag~"'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("name REGEXP 'a' OR tag REGEXP 'a'")]),r._v(" "),t("br"),t("br"),r._v(" ② 只查询id,sex,name这几列并且请求结果也按照这个顺序："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22@column%22:%22id,sex,name%22,%22id%22:38710%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@column":"id,sex,name"'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("SELECT id,sex,name")]),r._v(" "),t("br"),t("br"),r._v(" ③ 查询按 name降序、id默认顺序 排序的User数组："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22count%22:10,%22User%22:%7B%22@column%22:%22name,id%22,%22@order%22:%22name-,id%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@order":"name-,id"'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("ORDER BY name DESC,id")]),r._v(" "),t("br"),t("br"),r._v(" ④ 查询按userId分组的Moment数组："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22count%22:10,%22Moment%22:%7B%22@column%22:%22userId,id%22,%22@group%22:%22userId,id%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@group":"userId,id"'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("GROUP BY userId,id")]),r._v(" "),t("br"),t("br"),r._v(" ⑤ 查询 按userId分组、id最大值>=100 的Moment数组："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22count%22:10,%22Moment%22:%7B%22@column%22:%22userId%253Bmax(id)%22,%22@group%22:%22userId%22,%22@having%22:%22max(id)%3E=100%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@column":"userId;max(id)",'),t("br"),r._v('"@group":"userId",'),t("br"),r._v('"@having":"max(id)>=100"'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("SELECT userId,max(id) ... GROUP BY userId HAVING max(id)>=100")]),r._v(" "),t("br"),r._v("还可以指定函数返回名："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22count%22:10,%22Moment%22:%7B%22@column%22:%22userId%253Bmax(id):maxId%22,%22@group%22:%22userId%22,%22@having%22:%22maxId%3E=100%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@column":"userId;max(id):maxId",'),t("br"),r._v('"@group":"userId",'),t("br"),r._v('"@having":"maxId>=100"'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("SELECT userId,max(id) AS maxId ... GROUP BY userId HAVING maxId>=100")]),r._v(" "),t("br"),t("br"),r._v(" ⑥ 查询 sys 内的 User 表："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22@schema%22:%22sys%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@schema":"sys"'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("FROM sys.User")]),r._v(" "),t("br"),t("br"),r._v(" ⑦ 查询 PostgreSQL 数据库的 User 表："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22@database%22:%22POSTGRESQL%22,%22@explain%22:true%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@database":"POSTGRESQL"'),t("OutboundLink")],1),t("br"),t("br"),r._v(" ⑧ 将 VARCHAR 字符串字段 get 转为 JSONArray 返回："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22Access%22:%7B%22@json%22:%22get%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@json":"get"'),t("OutboundLink")],1),t("br"),t("br"),r._v(" ⑨ 查询当前用户的动态："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22Moment%22:%7B%22@role%22:%22OWNER%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@role":"OWNER"'),t("OutboundLink")],1),t("br"),t("br"),r._v(" ⑩ 开启性能分析："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22Moment%22:%7B%22@explain%22:true%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@explain":true'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("EXPLAIN")]),r._v(" "),t("br"),t("br"),r._v(" ⑪ 统计最近一周偶数userId的数量"),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22%5B%5D%22:%7B%22Moment%22:%7B%22@column%22:%22date%3bleft(date,10):day%3bsum(if(userId%252=0,1,0))%22,%22@group%22:%22day%22,%22@having%22:%22to_days(now())-to_days(%60date%60)%3C=7%22,%22@raw%22:%22@column,@having%22%7D%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@column":"date;left(date,10):day;sum(if(userId%2=0,1,0))",'),t("br"),r._v('"@group":"day",'),t("br"),r._v('"@having":"to_days(now())-to_days(`date`)<=7",'),t("br"),r._v('"@raw":"@column,@having"'),t("OutboundLink")],1),t("br"),r._v("对应SQL是"),t("code",[r._v("SELECT date, left(date,10) AS day, sum(if(userId%2=0,1,0)) ... GROUP BY day HAVING to_days(now())-to_days(`date`)<=7")]),r._v(" "),t("br"),t("br"),r._v(" ⑫ 从pictureList获取第0张图片："),t("br"),t("a",{attrs:{href:"http://apijson.cn:8080/get/%7B%22User%22:%7B%22id%22:38710,%22@position%22:0,%22firstPicture()%22:%22getFromArray(pictureList,@position)%22%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[r._v('"@position":0, //自定义关键词'),t("br"),r._v('"firstPicture()":"getFromArray(pictureList,@position)"'),t("OutboundLink")],1)])])])]),r._v(" "),t("br")])])])])])])])])])])])])}),[],!1,null,null,null);e.default=v.exports}}]);